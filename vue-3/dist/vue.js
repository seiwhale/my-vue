(()=>{"use strict";class t{constructor(){this.subs={}}addSub(t){this.subs[t.uid]=t}notify(){for(const t in this.subs)this.subs[t].update()}}let e=0;class s{constructor(t,s,n){this.exp=t,this.ctx=s,this.cb=n,this.uid=e++,this.update()}get(){t.target=this;let e=s.computeExpression(this.exp,this.ctx);return t.target=null,e}update(){let t=this.get();this.cb&&this.cb(t)}static computeExpression(t,e){return new Function("scope","with(scope){return "+t+"}")(e)}}const n=/^\s*([^\s"'<>\\/=]+)(?:\s*(=)\s*(?:"([^"]*)"+|'([^']*)'+|([^\s"'=<>]+)))?/,i="[a-zA-Z_][\\w\\-\\.]*",o=`((?:${i}\\:)?${i})`,a=new RegExp(`^<${o}`),r=/^\s*(\/?)>/,c=new RegExp(`^</${o}[^>]*>`),l=/^<!--/,h=t=>{let e={};for(let s=0;s<t.length;s++){const n=t[s];e[n.name]=n.value}return e};class d{constructor(t){if(this.ctx=t,this.$el=t.$el,this.$el){let t=function(t){let e,s,i=[];return function(t,e){let s=[],i=t,o=0;for(;i;){const t=i.indexOf("<");if(0===t){i.match(l)&&p(i.indexOf("--\x3e")+3);const t=h();t&&u(t);const e=i.match(c);e&&d(e)}let s="";t>0&&(s=i.slice(0,t),p(t)),t<0&&(s=i,i=""),e.chars&&e.chars(s)}function h(){const t=i.match(a);if(t){let e,s,a={tagName:t[1],attrs:[],start:o};for(p(t[0].length);!(e=i.match(r))&&(s=i.match(n));)a.attrs.push(s),p(s[0].length);return e&&(a.isUnary=e[1],a.end=o,p(e[0].length)),a}}function d(t){let n,i=t[1],o=0;if(i)for(n=i.toLowerCase(),o=s.length-1;o>=0&&s[o].lowerCaseTag!==n;o--);if(o>=0){for(let t=s.length-1;t>=o;t--){const e=s[t];(t>o||!i)&&console.warn(`Tag <${e.tagName}> has no matching tag.`)}e.end&&e.end(),s.length=o}p(t[0].length)}function u(t){let n=t.tagName,i=t.isUnary,o=[],a=(t=>"area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr".split(",").includes(t))(n)||!!i;o.length=t.attrs.length;for(let e=0;e<o.length;e++){const s=t.attrs[e];o[e]={name:s[1],value:s[3]||s[4]||s[5]}}a||s.push({attrs:o,tag:n,lowerCaseTag:n.toLowerCase()}),e.start&&e.start(n,o,a)}function p(t){o+=t,i=i.substring(t)}console.log(i)}(t,{start:(t,n,o)=>{let a={tag:t,type:1,attrsList:n,attrsMap:h(n),parent:s,children:[]};e||(e=a),s&&s.children.push(a),o||(s=a,i.push(a))},end:()=>{i.pop(),s=i[i.length-1]},chars:t=>{if(!s)return;const e=s.children;let n=(t=>{let e=/\{\{(.+?)\}\}/g,s=t.split(e),n=t.match(e),i=[];for(let t=0;t<s.length;t++){const e=s[t];n&&n.includes("{{"+e+"}}")?i.push("("+e+")"):i.push("`"+e+"`")}return i.join("+")})(t);t.trim()&&e.push({type:2,text:t,expression:n})}}),e}(this.$el.outerHTML);console.log("ast:",t),this.$fragment=this.nodeToFragment(this.$el),this.compile(this.$fragment),this.$el.appendChild(this.$fragment)}}nodeToFragment(t){let e=t.childNodes,s=document.createDocumentFragment();return e&&e.length&&e.forEach((t=>{this.ignorable(t)||s.appendChild(t)})),s}ignorable(t){return 8===t.nodeType||3===t.nodeType&&/^[\t\n\r]+/.test(t.textContent)}compile(t){t.childNodes.forEach((t=>{this.ignorable(t)||(1===t.nodeType?this.compileElementNode(t):3===t.nodeType&&this.compileTextNode(t))}))}compileElementNode(t){let e=[...t.attributes],n=this;e.forEach((e=>{let{name:i,value:o}=e;if(0===i.indexOf("v-"))switch(i.slice(2)){case"text":new s(o,this.ctx,(e=>{t.textContent=e}));break;case"model":new s(o,this.ctx,(e=>{t.value=e})),t.addEventListener("input",(t=>{n.ctx[o]=t.target.value}))}0===i.indexOf("@")&&this.compileMethod(t,i,o)})),this.compile(t)}compileMethod(t,e,s){let n=e.slice(1),i=this.ctx[s];t.addEventListener(n,i.bind(this.ctx))}compileTextNode(t){let e=t.textContent;if(e){let n=this.parseTextExp(e);new s(n,this.ctx,(e=>{t.textContent=e}))}}parseTextExp(t){let e=/\{\{(.+?)\}\}/g,s=t.split(e),n=t.match(e),i=[];return s.forEach((t=>{n&&n.indexOf("{{"+t+"}}")>-1?i.push("("+t+")"):i.push("`"+t+"`")})),i.join("+")}}class u{constructor(t){this.data=t,this.walk(this.data)}walk(t){t&&"object"==typeof t&&Object.keys(t).forEach((e=>{this.defineReactive(t,e,t[e])}))}defineReactive(e,s,n){let i=new t;Object.defineProperty(e,s,{enumerale:!0,configurable:!1,set:t=>{console.log("data set: ",s),n=t,i.notify()},get:()=>(console.log("data get: ",s),t.target&&i.addSub(t.target),n)}),this.walk(n)}}window.Vue=class{constructor(t){console.log("options: ",t),this.$el=document.querySelector(t.el),this.$data=t.data||{},this._proxyData(this.$data),this._proxyMethods(t.methods),new u(this.$data),new d(this)}_proxyData(t){Object.keys(t).forEach((e=>{Object.defineProperty(this,e,{set:s=>{t[e]=s},get:()=>t[e]})}))}_proxyMethods(t){t&&"object"==typeof t&&Object.keys(t).forEach((e=>{this[e]=t[e]}))}}})();